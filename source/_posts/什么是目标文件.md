---
title: 什么是目标文件
date: 2018-03-20 15:59:21
tags: android
subtitle: android
categories: android
---

> ### 前言

在学习elf文件格式的中他的头文件的时候，有关于目标文件的这个概念一直模棱两可，被弄得云里雾里的，今天在读《程序员自我修养》一书后，我对这个知识的理解有了初步的概念。那就写下来记录一下，目标文件是个啥。

> ### 代码处理过程

我要知道什么是目标文件，必须清楚，一份源代码是如何被计算机运行起来的，比如一个简单的打印helloworld程序，他到底是如何打印出来被我们看见的(我只大体说出他的流程，不考虑他的细节)。好，首先写一个简单的helloworld程序。

```c
//test.c
#include<stdio.h>
int main()
{
    printf("hello world\n");
    return 0;
}
```

上面是一段用c语言来写的程序，这份源代码，想要被计算机认识，执行需要经过如下4个过程：

![](/images/progress.jpg)

#### 预处理

使用命令`gcc -E test.c -o test.i`

1.在这个阶段，源代码中所有的`#define`会被删除，并且会展开所有的宏定义。

2.处理所有条件预编译指令，如：`#if,#ifdef,#else,#elif,#endif`。

3.处理`#include`预编译指令，将包含的文件插入到预编译指令的位置，过程递归，引用到的其他文件可能还会包含其他文件。

4.删除所有注释符号。

5.添加行号和文件标识，如`# 2 "test.c" 2`，

6.保留所有`#pragma`编译器指令，编译器所需。

#### 编译

使用命令`gcc -S test.i -o test.s`

这个过程就是将预处理好的文件，进行词法分析，语法分析，语义分析，优化所生成的汇编代码文件。

#### 汇编

使用命令`gcc -c test.s -o test.o`

在这个过程中，就是将汇编代码转换成机器可以识别的二进制的机器指令。

#### 链接

大体上就是将所需要的各种文件链接起来形成可执行的最终文件。

> ### 目标文件是什么

目标文件是源代码编译后未被链接的中间文件（linux系统上的.o文件），他与最终的可执行文件的文件结构十分相似，他就是Linux系统上的elf文件，elf文件格式具体分成4类：
